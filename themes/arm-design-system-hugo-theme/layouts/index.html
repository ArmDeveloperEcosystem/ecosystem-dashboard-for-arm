{{/* 
    Basic list, expandable info. 
    Search = name. Sorting = bonus    
    Info: up-front loading for all SW. Two options:
        - one_file JSON, or
        - multi_files JSONs
*/}}



{{define "main"}}


{{/*******************************************************
                HUGO VARIABLE INITALIZATION
*******************************************************/}}
<!-- Get all SWs -->
{{ $swData := .Site.GetPage "/opensource_packages" }}

{{ $packages_opensource := .Site.GetPage "/opensource_packages" }}
{{ $packages_commercial := .Site.GetPage "/commercial_packages" }}

{{ $packages_opensource := where (.Site.GetPage "/opensource_packages").Pages "Type" "opensource_packages" }}
{{ $packages_commercial := where (.Site.GetPage "/commercial_packages").Pages "Type" "commercial_packages" }}
{{ $packages_all := $packages_opensource | union $packages_commercial }}
{{ $packages_alphabetical_order := sort $packages_all ".Params.name" }}

<!-- Get initial most recent 5 packages from data file -->
{{ $recent_packages := $.Site.Data.recently_added_packages }}

<!-- Get all Filter categories from data file -->
{{ $filter_categories := .Site.Data.active_categories }}

{{/*******************************************************
*******************************************************/}}


<!-- space for top header to stay clear of other stuff -->
<div style="height: 100px;"></div>
{{ partial "eco-dashboard/title-top.html" .}} 


<div id="all-content-div" class="c-container is-responsive-width" style="min-height: 250px;">
    <p style="margin-bottom: 16px; text-align: center;">
        Migrating your cloud server app to Arm? 
        Discover what software packages work on Arm, the recommended and minimum supported versions, download links, and quick-start resources.
        <br>
        This data is sourced from Arm and our wide software ecosystem. 
        While we make our best efforts to keep this dashboard accurate, there are no guarantees of data correctness due to the ever-evolving software landscape. 
        For more details, read the <a href="https://github.com/ArmDeveloperEcosystem/ecosystem-dashboard-for-arm/blob/main/datapoint-boundary-conditions.md" target="_blank"> contribution guidelines here</a> to understand how packages are added.
    </p>



    <!-- Page wrapping row -->
    <div class="c-row md:is-collapsed u-gap-1-1/2 u-flex-nowrap u-padding-top-2 u-padding-bottom-2-1/2">
        <!-- Filter bar on left -->
        <div class="c-col u-hide lg:u-display-block u-flex-shrink-0 filter-column-div">
            {{ partial "eco-dashboard/filter-box.html" (dict "context" . "categories" $filter_categories)}}
        </div>

        <!-- Search & Results on Right -->
        <div class="c-col">

            <!-- Guided content for new starters -->
            <div style="text-align: left; margin-top: -16px; padding-bottom: 16px; padding-left: 16px;">
                <a href="https://github.com/ArmDeveloperEcosystem/ecosystem-dashboard-for-arm/blob/main/contrib.md"><h6 class="basics-title">Package missing that works on Arm? Submit it via GitHub. </h6></a>
            </div>

            <!-- Search, and mobile filtering support -->
            {{ partial "eco-dashboard/mobile-search-and-filter.html" (dict "context" . "categories" $filter_categories)}} 

            <!-- Bars: Active Filters, # content displayed, sort by. -->
            {{ partial "eco-dashboard/active-filter-and-sort-bar.html" (dict "content_to_list" $swData "page_type" "packages")}} 


            <!-- Data table -->
            {{ partial "package-display/table.html" $recent_packages}}

            <table class="c-table is-selectable" cellspacing="0">
            <thead>
                <tr>
                    <!--<th style="width: max-content"></th>-->
                    <th>Package Name</th>
                    <th>Works on Arm</th>
                </tr>
            </thead>
                <tbody id="sw-tablebody">
                    {{ $id_index := 0}}
                    {{ range sort  $swData.Pages "Params.name" }}
                        {{ $id_index = add $id_index 1 }}
                            {{/* URLIZE with changing / to - of category names */}}
                            {{ $replaced := replace .Params.category "/" "__" }}
                            {{ $urlized := $replaced | urlize }}
                            <tr id="row-{{$id_index}}" class="c-table-row main-sw-row search-div tag-{{ $urlized}}" onclick="rowClickHandler(this);">                              
                                <td class="search-title">
                                    <div class="package-name">
                                        {{ .Params.name }}
                                    </div>
                                </td>
                                <td>
                                    {{if .Params.works_on_arm}}
                                        <div class="does-work-on-arm-div {{if .Params.optional_info.support_caveats}}support-caveats{{end}}">
                                            True
                                        </div>                                        
                                    {{else}}
                                        <div class="not-work-on-arm-div {{if .Params.optional_info.alternative_options}}alternative-options{{end}}">
                                            False
                                        </div>
                                    {{end}}
                                    {{/* <span><i class="fa-light fa-clock fa-sm"></i></span>&nbsp; <span class="time-to-complete-string">{{.Params.supported_minimum_version.release_date}}</span> */}}
                                </td>
                            </tr>
                            <tr hidden="true">
                                <td class='expanded-container' colspan="3">
                                    <div class="sw-information-grid">

                                        <section class="u-flex sw-information">
                                            <div class="section-single-col">
                                                <table class="align-table" width="100%" style="width: 100%; border-collapse: collapse; margin: 0px; padding: 0px;">
                                                    <tr>
                                                        <td style="width:75%; margin: 0px; padding: 0px;">
                                                            <u><b>Category:</b> {{.Params.category}}</u>
                                                        </td>
                                                        <td style="margin: 0px; padding: 0px;">
                                                            {{partial "eco-dashboard/github-links.html" .  }}
                                                        </td>
                                                    </tr>
                                                </table>                                          
                                                {{.Params.description }}
                                            </div>
                                        </section>

                                        {{/* DOES WORK ON ARM CATEGORIES */}}
                                        {{if .Params.works_on_arm}}
                                            
                                            <section class="u-flex sw-information">
                                                <div class="field">Versions supported</div>                               
                                                <div class="description">
                                                    <span class="version-number">{{.Params.supported_minimum_version.version_number}}</span>+ is the minimum version effective on Arm servers. <br>

                                                    {{if .Params.optional_info.arm_recommended_minimum_version.version_number}}
                                                        For best performance and security, Arm recommends version <span class="version-number">{{.Params.optional_info.arm_recommended_minimum_version.version_number}}</span>+.
                                                    {{else}}
                                                        For best performance and security, always use the lastest version when possible.
                                                    {{end}}
                                                    
                                                </div>
                                            </section>
                                            
                                            {{if .Params.optional_info.support_caveats}}
                                            <section class="u-flex sw-information">
                                                <div class="field">Support Notes:</div>                               
                                                <div class="description">
                                                    {{.Params.optional_info.support_caveats | markdownify  }}
                                                </div>
                                            </section>
                                            {{end}}

                                            <section class="u-flex sw-information">
                                                <div class="field">Download link</div>                               
                                                <div class="description">
                                                    <a href="{{.Params.download_url}}" target="_blank">
                                                        Download
                                                    </a>
                                                </div>
                                            </section>

                                            <section class="u-flex sw-information">
                                                <div class="field">Quick-start guides</div>                               
                                                <div class="description">
                                                    {{ with .Params.optional_info.getting_started_resources }}
                                                        <ul>
                                                        {{if .arm_content}}
                                                            <li><a target="_blank" href="{{.arm_content}}">Arm guide</a>
                                                            <br>
                                                        {{end}}
                                                        {{if .partner_content}}
                                                            <li><a target="_blank" href="{{.partner_content}}">Cloud Service Provider guide</a>
                                                            <br>
                                                        {{end}}
                                                        {{if .official_docs}}
                                                            <li><a target="_blank" href="{{.official_docs}}">Official documentation</a>
                                                        {{end}}
                                                        </ul>
                                                    {{end}}
                                                </div>
                                            </section>

                                        {{else}} {{/* If DOES NOT work on Arm */}}


                                            <section class="u-flex sw-information">
                                                <div class="field">Alternative package options</div>
                                                <div class="description">
                                                    {{if .Params.optional_info.alternative_options}}
                                                        {{.Params.optional_info.alternative_options }}
                                                    
                                                    {{else}}
                                                        {{partial "eco-dashboard/github-alternative-suggestion.html" .  }}
                                                    {{end}}
                                                </div>
                                            </section>


                                        {{end}}
                                    </div>
                                </td>
                            </tr>
                    {{end}}
                </tbody>

            </table>
        </div> <!-- end of row -->
    </div>  <!-- end of filter/search div -->
</div> <!-- end of end-to-end all content div -->


{{/* 

{{ range $swData.Pages }}

<ads-expansion-panel>
    <span slot="toggle">
        {{ .Params.name }} 
        <ads-tag style="margin-bottom: 4px;">
            <span class="u-flex u-flex-row u-align-items-center u-gap-1/2">
            <span class="fa-solid fa-tag"></span>
            {{ .Params.works_on_arm }}
        </ads-tag> 
    </span>
    <div slot="content">
        {{.Params.description}}
    </div>
</ads-expansion-panel>
{{ end }}
*/}}
<div style="margin-bottom: 150px;"></div>


</div>
{{end}}