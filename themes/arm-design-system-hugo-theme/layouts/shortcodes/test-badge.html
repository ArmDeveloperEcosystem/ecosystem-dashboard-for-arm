{{- $package := .Get "package" -}}
{{- $testData := index .Site.Data "test-results" $package -}}

{{- if $testData -}}
  {{- $status := $testData.metadata.badge_status -}}
  {{- $badgeClass := "passing" -}}
  {{- $badgeText := "unknown" -}}
  
  {{- if eq $status "passing" -}}
    {{- $badgeClass = "success" -}}
    {{- $badgeText = printf "%d passing" $testData.tests.passed -}}
  {{- else if eq $status "failing" -}}
    {{- $badgeClass = "danger" -}}
    {{- $badgeText = printf "%d failing" $testData.tests.failed -}}
  {{- else -}}
    {{- $badgeClass = "secondary" -}}
    {{- $badgeText = $status -}}
  {{- end -}}

  <div class="test-badge-container" style="margin: 1rem 0;">
    <div style="display: inline-flex; align-items: center; gap: 0.5rem;">
      {{- if $testData.run.url -}}
      <a href="{{ $testData.run.url }}" target="_blank" rel="noopener" style="text-decoration: none;">
      {{- end -}}
        <span class="badge badge-{{ $badgeClass }}" style="padding: 0.25rem 0.75rem; border-radius: 0.25rem; font-size: 0.875rem; font-weight: 500;">
          ğŸ”§ ARM64 Tests: {{ $badgeText }}
        </span>
      {{- if $testData.run.url -}}
      </a>
      {{- end -}}
      
      {{- if $testData.run.timestamp -}}
      <small style="color: #6c757d; font-size: 0.75rem;">
        Last tested: {{ $testData.run.timestamp }}
        {{- if $testData.package.version -}}
        | Version: {{ $testData.package.version }}
        {{- end -}}
      </small>
      {{- end -}}
    </div>
    
    {{- if $testData.tests.details -}}
    <details style="margin-top: 0.5rem; padding: 0.5rem; background-color: #f8f9fa; border-radius: 0.25rem;">
      <summary style="cursor: pointer; font-weight: 500; user-select: none;">Test Details</summary>
      <ul style="margin-top: 0.5rem; margin-bottom: 0; padding-left: 1.5rem;">
        {{- range $testData.tests.details -}}
        <li style="margin: 0.25rem 0;">
          {{- if eq .status "passed" -}}
          âœ…
          {{- else if eq .status "failed" -}}
          âŒ
          {{- else -}}
          â­ï¸
          {{- end -}}
          {{ .name }}
          <small style="color: #6c757d;">({{ .duration_seconds }}s)</small>
        </li>
        {{- end -}}
      </ul>
      <div style="margin-top: 0.5rem; font-size: 0.875rem; color: #6c757d;">
        Total duration: {{ $testData.tests.duration_seconds }}s
        | Runner: {{ $testData.run.runner.os }} ({{ $testData.run.runner.arch }})
      </div>
    </details>
    {{- end -}}
  </div>
{{- else -}}
  <!-- No test data available for {{ $package }} -->
{{- end -}}
